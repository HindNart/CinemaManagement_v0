<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${movie.tenPhim}"></title>
    <link rel="stylesheet" href="/css/filmStyle.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
	    document.addEventListener("DOMContentLoaded", function () {
	        var modalToggleButtons = document.querySelectorAll('.schedule-time-item');      
	        modalToggleButtons.forEach(button => {
	            button.addEventListener('click', function () {
	                var startTime = button.getAttribute('data-start-time');
	                var endTime = button.getAttribute('data-end-time');
	                var showTime = button.getAttribute('data-show-time');
	                var room = button.getAttribute('data-room');
	                var roomType = button.getAttribute('data-room-type');
	                // Update content in the modal
	                var modalTimeElement = document.getElementById("timeSchedule");
	                modalTimeElement.value = startTime + ' ~ ' + endTime;
	                
	                var modalTimeElement2 = document.getElementById("showTime");
	                modalTimeElement2.value = showTime;
	                
	                var modalTimeElement3 = document.getElementById("showRoom");
	                modalTimeElement3.textContent = room;
	                
	                var modalTimeElement3 = document.getElementById("roomType");
	                modalTimeElement3.textContent = roomType;
	                // Close the dropdown if it's open (optional)
	                var dropdown = document.querySelector('.dropdown-content');
	                dropdown.classList.remove('show');
	
	                // Optionally, you can trigger the modal opening programmatically
	                var modalToggle = new bootstrap.Modal(document.getElementById('exampleModalToggle'));
	                modalToggle.show();
	            });
	        });
	    });

        document.addEventListener("DOMContentLoaded", function () {
            let listChoosen = document.getElementById("seat-chosens");

            function addSeat(button) {
                var chairValue = button.value;

                // Ki·ªÉm tra xem gh·∫ø ƒë√£ ƒë∆∞·ª£c ch·ªçn hay ch∆∞a
                var existingSeats = listChoosen.querySelectorAll(".seat-chosen");
                for (var i = 0; i < existingSeats.length; i++) {
                    if (existingSeats[i].textContent === chairValue) {
                        alert("Gh·∫ø n√†y ƒë√£ ƒë∆∞·ª£c ch·ªçn!");
                        return;
                    }
                }

                // T·∫°o m·ªôt ph·∫ßn t·ª≠ m·ªõi ƒë·ªÉ ch·ª©a th√¥ng tin gh·∫ø
                let seat = document.createElement("div");
                seat.className = "seat-chosen";
                seat.textContent = chairValue;
                listChoosen.appendChild(seat);
                seat.addEventListener("click", function () {
                    listChoosen.removeChild(seat);
                });
            }

            // G√°n h√†m addSeat cho c√°c n√∫t gh·∫ø
            var seatButtons = document.querySelectorAll(".normal-seat, .vip-seat, .couple-seat");
            seatButtons.forEach(button => {
                button.addEventListener("click", function () {
                    addSeat(button);
                });
            });
        });
        function loadContent(fragment) {
            fetch(fragment)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => console.error('Error loading content:', error));
        }
    </script>
</head>
<body>
    <div id="header">
         <div class="navbar">
                <div class="logo"></div>
                <div class="nav-content">
                    <ul>
                        <li class="nav-dropdown">L·ªãch chi·∫øu
                            <div class="dropdown-content">
                                <a href="#">Phim ƒëang chi·∫øu</a>
                                <a href="#">Phim s·∫Øp chi·∫øu</a>
                            </div>
                        </li>
                        <li>Phim chi·∫øu</li>
                        <li>Review phim</li>
                    </ul>
                </div>
                <div class="user flex">
                    <div class="user-avt">
                        <img class="brr-50" src="/img/phim1.jpg" alt="" width="50px" height="50px">
                    </div>
                    <div class="user-name nav-dropdown">
                        <span th:if="${account != null}"><p th:text="${account.username}"></p></span>
                        <i class="bi bi-chevron-compact-down"></i>
                        <div class="dropdown-content">
                            <a href="#">Th√¥ng tin</a>
                            <a th:href="@{/login}">ƒêƒÉng xu·∫•t</a>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    <div class="film-info pa-64">
        <div class="film-info-img"><img th:src="${movie.LinkPoster}" alt="" width="250px" height="350px"></div>
        <div class="film-info-details">
            <p class="ageFilm margin-tb-10">P</p>
            <h1 th:text="${movie.tenPhim}"></h1>
            <p class="opacity-7 margin-tb-10" th:text="${movie.tenPhim}"> ¬∑ <p ><span th:text="${movie.thoiLuong}"></span> ph√∫t</p>
            <p>üåü <span th:text="${#numbers.formatDecimal(averageRatings[movie.idPhim], 1, 1)}"></span> </p>
            <b>N·ªôi dung</b>
            <p class="opacity-7" th:text="${movie.moTa}"></p>
            <div class="flex justify-content-between margin-tb-10">
                <div class="">
                    <p class="opacity-7">Ng√†y chi·∫øu</p>
                    <b th:text="${movie.ngayPH}"></b>
                </div>
                <div class="">
                    <p class="opacity-7">Th·ªÉ lo·∫°i</p>
                    <b th:text="${movie.theLoai}"></b>
                </div>
            </div>
        </div>
    </div>
    <div class="schedule-show pa-64">
        <h3>L·ªãch chi·∫øu <span th:text="${movie.tenPhim}"></span></h3>
        <div class="schedule-container" th:each="date : ${uniqueDates}">
            <div class="schedule-list"  >
                <div class="schedule-date">
                    <p class="bg-gray" th:text="${date}"></p>
                </div>
            </div>
            <div class="schedule-time-container">
                <div class="schedule-time">
                    <p><b>2D L·ªìng ti·∫øng</b></p>
                    <div class="" style="margin-left:-3px;" >                	
                        <div  th:each="schedule : ${movieSchedule}"
                        	th:if="${date == schedule.ngayChieu}"  
                        	class="schedule-time-item btn btn-primary ms-1 me-1" data-bs-target="#exampleModalToggle"  
                            data-bs-toggle="modal"
                            th:attr="data-start-time=${schedule.thoigianBD}, data-end-time=${schedule.thoigianKT}, data-show-time=${schedule.ngayChieu}, data-room=${schedule.phongChieu.idPhong},data-room-type=${schedule.phongChieu.loaiPhong}">
                            <a class="text-white" style="text-decoration: none" th:href="@{/showBuyTicket/{id}(id=${schedule.idLichChieu})}"><span th:text="${schedule.thoigianBD}"></span> ~ <span th:text="${schedule.thoigianKT}"></span></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    
    <div class="comments pa-64">
    	
	    <form action="#" th:action="@{/saveRate}" th:object="${newRate}" method="post">
            <div class="mb-3">
                <select class="form-select w-auto mb-3" id="selectRating" th:field="*{diem}" aria-label="Default select example" required>
                    <option value="10" disabled selected>ƒêi·ªÉm</option>
                    <option th:value="1">1</option>
                    <option th:value="2">2</option>
                    <option th:value="3">3</option>
                    <option th:value="4">4</option>
                    <option th:value="5">5</option>
                    <option th:value="6">6</option>
                    <option th:value="7">7</option>
                    <option th:value="8">8</option>
                    <option th:value="9">9</option>
                    <option th:value="10">10</option>
                </select>
                
                <label for="textareaComment" class="form-label mb-3">B√¨nh lu·∫≠n</label>
                <textarea class="form-control" id="textareaComment" th:field="*{binhLuan}" rows="3"></textarea>                
    			<input type="hidden" th:field="*{taiKhoan}"/>
    			<input type="hidden" th:field="*{Phim}"/>
            </div>
            <button type="submit" class="btn btn-primary mb-3 mt-3">G·ª≠i ƒë√°nh gi√°</button>
        </form>
        <div class="">
            <h3 class="comments-title">B√¨nh lu·∫≠n t·ª´ ng∆∞·ªùi xem</h3>
            <div class="user-comment" th:each="rate:${rates}" th:if="${rate.Phim.idPhim == movie.idPhim}">
                <div class=" flex" >
                    <div class="user-avt"><img src="https://static.vecteezy.com/system/resources/thumbnails/002/318/271/small_2x/user-profile-icon-free-vector.jpg" alt="" width="50px" height="50px"></div>
                    <div class="user-info">
                        <p th:text="${rate.taiKhoan.username}"></p>
                    </div>
                </div>
                <div>
                    <div class="comment-rate mg-10 ">üåü <span th:text="${rate.diem}"></span>/10 ‚Ä¢</div>
                    <div class="comment-content" th:text="${rate.binhLuan}"></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
