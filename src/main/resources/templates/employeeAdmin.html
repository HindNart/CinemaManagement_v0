<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý rạp phim</title>
<link rel="shortcut icon" type="image/png" href="/img/film.png" />
<link rel="stylesheet" href="/css/style.css">
<script src="/js/script.js"></script>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/billboard.js/dist/billboard.min.js"></script>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/billboard.js/dist/billboard.min.css" />
<link
	rel="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
	type="text/css" />

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js">
	</script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js">
	</script>

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1/Chart.min.js">
	</script>
</head>
<body>
	<div id="header">
		<div class="flex spc-btw">
			<div class="logo">
				<a th:href="@{/}"> <img src="/img/LET.png" width="125px"
					height="100%">
				</a>
			</div>
			<div class="user flex">
				<div class="user-avt">
					<img class="brr-50"
						src="https://www.iconpacks.net/icons/2/free-user-icon-3296-thumb.png"
						alt="" width="50px" height="50px">
				</div>
				<div class="user-name nav-dropdown">
					<p th:text="${account.username}"> <i class="bi bi-chevron-compact-down"></i></p> 
					<div class="dropdown-content">
						<a th:href="@{/logout/{id}(id=${account.email})}">Logout</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="sidebar" class="width-15">
		<a onclick="loadContent('/movieSchedules')" id="load-sche" href=""
			class="text-white">
			<div class="sidebar-btn shadow p-3 mb-5 bg-body-tertiary rounded">
				<i class="bi bi-calendar-event-fill"></i> Lịch chiếu
			</div>
		</a> <a onclick="loadContent('/showCinemaRoom')" id="load-room"
			class="text-white" href="">
			<div class="sidebar-btn shadow p-3 mb-5 bg-body-tertiary rounded">
				<i class="bi bi-columns-gap"></i> Phòng chiếu
			</div>
		</a> <a onclick="loadContent('/showAllMovies')" id="load-movie"
			class="text-white" href="">
			<div class="sidebar-btn shadow p-3 mb-5 bg-body-tertiary rounded">
				<i class="bi bi-film"></i> Phim
			</div>
		</a>
	</div>
	<div class="width-80">
		<div id="content" class="main-content">
			<div class="main-title">
				<h2>Dashboard</h2>
			</div>
			<div class="db-item">
			</div>
		</div>
	</div>

	<script>
        function loadContent(fragment) {
            fetch(fragment)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => console.error('Error loading content:', error));
        }

        const sidebarButtons = document.querySelectorAll('.sidebar-btn');
        sidebarButtons.forEach(button => {
            button.addEventListener('click', function (event) {
                event.preventDefault();

                // Remove 'active' class from all sidebar buttons
                sidebarButtons.forEach(btn => btn.classList.remove('active'));

                // Add 'active' class to the clicked button
                this.classList.add('active');
            });
        });
    </script>
    
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
	    fetch('/countTickets')
	        .then(response => response.json())
	        .then(data => {
	            console.log("Fetched stats:", data);
	            const months = data.map(stat => `Tháng ${stat.month}`);
	            const ticketCounts = data.map(stat => stat.ticketCount);
	
	            // Khởi tạo biểu đồ Chart.js
	            const ctx = document.getElementById('ticketChart').getContext('2d');
	            new Chart(ctx, {
	                type: 'bar',
	                data: {
	                    labels: months,
	                    datasets: [{
	                        label: 'Số vé bán được',
	                        data: ticketCounts,
	                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
	                        borderColor: 'rgba(75, 192, 192, 1)',
	                        borderWidth: 1
	                    }]
	                },
	                options: {
	                    scales: {
	                        y: {
	                            beginAtZero: true
	                        }
	                    }
	                }
	            });
	        })
	        .catch(err => console.error("Error fetching ticket:", err));
	    
	    fetch('/totalPriceTicketsMonth')
        .then(response => response.json())
        .then(data => {
            console.log("Fetched stats:", data);
            const months = data.map(stat => `Tháng ${stat.month}`);
            const priceTicket = data.map(stat => stat.totalPrice);

            // Khởi tạo biểu đồ Chart.js
            const ctx = document.getElementById('totalPriceTicketChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Doanh thu (VND)',
                        data: priceTicket,
                        backgroundColor: 'rgba(255, 255, 0, 0.2)',
                        borderColor: 'rgba(255, 255, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        })
        .catch(err => console.error("Error fetching ticket price:", err));
	</script>
</body>
</html>
